<!DOCTYPE html><html lang="en"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><meta name="generator" content="rustdoc"><meta name="description" content="‚ö†Ô∏è Experimental Support for reading and writing `Variant`s to / from Parquet files ‚ö†Ô∏è"><title>parquet::variant - Rust</title><script>if(window.location.protocol!=="file:")document.head.insertAdjacentHTML("beforeend","SourceSerif4-Regular-6b053e98.ttf.woff2,FiraSans-Italic-81dc35de.woff2,FiraSans-Regular-0fe48ade.woff2,FiraSans-MediumItalic-ccf7e434.woff2,FiraSans-Medium-e1aa3f0a.woff2,SourceCodePro-Regular-8badfe75.ttf.woff2,SourceCodePro-Semibold-aa29a496.ttf.woff2".split(",").map(f=>`<link rel="preload" as="font" type="font/woff2"href="../../static.files/${f}">`).join(""))</script><link rel="stylesheet" href="../../static.files/normalize-9960930a.css"><link rel="stylesheet" href="../../static.files/rustdoc-ca0dd0c4.css"><meta name="rustdoc-vars" data-root-path="../../" data-static-root-path="../../static.files/" data-current-crate="parquet" data-themes="" data-resource-suffix="" data-rustdoc-version="1.93.0-nightly (82ae0ee64 2025-10-31)" data-channel="nightly" data-search-js="search-6acd48a0.js" data-stringdex-js="stringdex-c3e638e9.js" data-settings-js="settings-c38705f0.js" ><script src="../../static.files/storage-e2aeef58.js"></script><script defer src="../sidebar-items.js"></script><script defer src="../../static.files/main-ce535bd0.js"></script><noscript><link rel="stylesheet" href="../../static.files/noscript-263c88ec.css"></noscript><link rel="icon" href="https://raw.githubusercontent.com/apache/parquet-format/25f05e73d8cd7f5c83532ce51cb4f4de8ba5f2a2/logo/parquet-logos_1.svg"></head><body class="rustdoc mod"><!--[if lte IE 11]><div class="warning">This old browser is unsupported and will most likely display funky things.</div><![endif]--><rustdoc-topbar><h2><a href="#">Module variant</a></h2></rustdoc-topbar><nav class="sidebar"><div class="sidebar-crate"><a class="logo-container" href="../../parquet/index.html"><img src="https://raw.githubusercontent.com/apache/parquet-format/25f05e73d8cd7f5c83532ce51cb4f4de8ba5f2a2/logo/parquet-logos_1.svg" alt="logo"></a><h2><a href="../../parquet/index.html">parquet</a><span class="version">57.0.0</span></h2></div><div class="sidebar-elems"><section id="rustdoc-toc"><h2 class="location"><a href="#">Module variant</a></h2><h3><a href="#">Sections</a></h3><ul class="block top-toc"><li><a href="#features" title="Features">Features</a></li><li><a href="#example-writing-a-parquet-file-with-variant-column" title="Example: Writing a Parquet file with Variant column">Example: Writing a Parquet file with Variant column</a></li><li><a href="#example-writing-json-into-a-parquet-file-with-variant-column" title="Example: Writing JSON into a Parquet file with Variant column">Example: Writing JSON into a Parquet file with Variant column</a></li><li><a href="#example-reading-a-parquet-file-with-variant-column" title="Example: Reading a Parquet file with Variant column">Example: Reading a Parquet file with Variant column</a></li></ul><h3><a href="#structs">Module Items</a></h3><ul class="block"><li><a href="#structs" title="Structs">Structs</a></li><li><a href="#enums" title="Enums">Enums</a></li><li><a href="#constants" title="Constants">Constants</a></li><li><a href="#traits" title="Traits">Traits</a></li><li><a href="#functions" title="Functions">Functions</a></li></ul></section><div id="rustdoc-modnav"><h2 class="in-crate"><a href="../index.html">In crate parquet</a></h2></div></div></nav><div class="sidebar-resizer" title="Drag to resize sidebar"></div><main><div class="width-limiter"><section id="main-content" class="content"><div class="main-heading"><div class="rustdoc-breadcrumbs"><a href="../index.html">parquet</a></div><h1>Module <span>variant</span>&nbsp;<button id="copy-path" title="Copy item path to clipboard">Copy item path</button></h1><rustdoc-toolbar></rustdoc-toolbar><span class="sub-heading"><a class="src" href="../../src/parquet/variant.rs.html#18-303">Source</a> </span></div><details class="toggle top-doc" open><summary class="hideme"><span>Expand description</span></summary><div class="docblock"><p>‚ö†Ô∏è Experimental Support for reading and writing <a href="enum.Variant.html" title="enum parquet::variant::Variant"><code>Variant</code></a>s to / from Parquet files ‚ö†Ô∏è</p>
<p>This is a üöß Work In Progress</p>
<p>Note: Requires the <code>variant_experimental</code> feature of the <code>parquet</code> crate to be enabled.</p>
<h2 id="features"><a class="doc-anchor" href="#features">¬ß</a>Features</h2>
<ul>
<li>Representation of <a href="enum.Variant.html" title="enum parquet::variant::Variant"><code>Variant</code></a>, and <a href="struct.VariantArray.html" title="struct parquet::variant::VariantArray"><code>VariantArray</code></a> for working with
Variant values (see [<code>parquet_variant</code>] for more details)</li>
<li>Kernels for working with arrays of Variant values
such as conversion between <code>Variant</code> and JSON, and shredding/unshredding
(see [<code>parquet_variant_compute</code>] for more details)</li>
</ul>
<h2 id="example-writing-a-parquet-file-with-variant-column"><a class="doc-anchor" href="#example-writing-a-parquet-file-with-variant-column">¬ß</a>Example: Writing a Parquet file with Variant column</h2>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code> <span class="comment">// Use the VariantArrayBuilder to build a VariantArray
 </span><span class="kw">let </span><span class="kw-2">mut </span>builder = VariantArrayBuilder::new(<span class="number">3</span>);
 builder.new_object().with_field(<span class="string">"name"</span>, <span class="string">"Alice"</span>).finish(); <span class="comment">// row 1: {"name": "Alice"}
 </span>builder.append_value(<span class="string">"such wow"</span>); <span class="comment">// row 2: "such wow" (a string)
 </span><span class="kw">let </span>array = builder.build();

 <span class="comment">// Since VariantArray is an ExtensionType, it needs to be converted
 // to an ArrayRef and Field with the appropriate metadata
 // before it can be written to a Parquet file
 </span><span class="kw">let </span>field = array.field(<span class="string">"data"</span>);
 <span class="kw">let </span>array = ArrayRef::from(array);
 <span class="comment">// create a RecordBatch with the VariantArray
 </span><span class="kw">let </span>schema = Schema::new(<span class="macro">vec!</span>[field]);
 <span class="kw">let </span>batch = RecordBatch::try_new(Arc::new(schema), <span class="macro">vec!</span>[array])<span class="question-mark">?</span>;

 <span class="comment">// Now you can write the RecordBatch to the Parquet file, as normal
 </span><span class="kw">let </span>file = std::fs::File::create(<span class="string">"variant.parquet"</span>)<span class="question-mark">?</span>;
 <span class="kw">let </span><span class="kw-2">mut </span>writer = ArrowWriter::try_new(file, batch.schema(), <span class="prelude-val">None</span>)<span class="question-mark">?</span>;
 writer.write(<span class="kw-2">&amp;</span>batch)<span class="question-mark">?</span>;
 writer.close()<span class="question-mark">?</span>;
</code></pre></div><h2 id="example-writing-json-into-a-parquet-file-with-variant-column"><a class="doc-anchor" href="#example-writing-json-into-a-parquet-file-with-variant-column">¬ß</a>Example: Writing JSON into a Parquet file with Variant column</h2>
<div class="example-wrap"><pre class="rust rust-example-rendered"><code> <span class="comment">// Create an array of JSON strings, simulating a column of JSON data
 </span><span class="kw">let </span>input_array: ArrayRef = Arc::new(StringArray::from(<span class="macro">vec!</span>[
  <span class="prelude-val">Some</span>(<span class="string">r#"{"name": "Alice", "age": 30}"#</span>),
  <span class="prelude-val">Some</span>(<span class="string">r#"{"name": "Bob", "age": 25, "address": {"city": "New York"}}"#</span>),
  <span class="prelude-val">None</span>,
  <span class="prelude-val">Some</span>(<span class="string">"{}"</span>),
 ]));

 <span class="comment">// Convert the JSON strings to a VariantArray
 </span><span class="kw">let </span>array: VariantArray = json_to_variant(<span class="kw-2">&amp;</span>input_array)<span class="question-mark">?</span>;
 <span class="comment">// create a RecordBatch with the VariantArray
 </span><span class="kw">let </span>schema = Schema::new(<span class="macro">vec!</span>[array.field(<span class="string">"data"</span>)]);
 <span class="kw">let </span>batch = RecordBatch::try_new(Arc::new(schema), <span class="macro">vec!</span>[ArrayRef::from(array)])<span class="question-mark">?</span>;

 <span class="comment">// write the RecordBatch to a Parquet file as normal
 </span><span class="kw">let </span>file = std::fs::File::create(<span class="string">"variant-json.parquet"</span>)<span class="question-mark">?</span>;
 <span class="kw">let </span><span class="kw-2">mut </span>writer = ArrowWriter::try_new(file, batch.schema(), <span class="prelude-val">None</span>)<span class="question-mark">?</span>;
 writer.write(<span class="kw-2">&amp;</span>batch)<span class="question-mark">?</span>;
 writer.close()<span class="question-mark">?</span>;</code></pre></div><h2 id="example-reading-a-parquet-file-with-variant-column"><a class="doc-anchor" href="#example-reading-a-parquet-file-with-variant-column">¬ß</a>Example: Reading a Parquet file with Variant column</h2>
<p>Use the <a href="struct.VariantType.html" title="struct parquet::variant::VariantType"><code>VariantType</code></a> extension type to find the Variant column:</p>

<div class="example-wrap"><pre class="rust rust-example-rendered"><code><span class="comment">// Read the Parquet file using standard Arrow Parquet reader.
// Note this file has 2 columns: "id", "var", and the "var" column
</span><span class="kw">let </span>file = std::fs::File::open(file_path())<span class="question-mark">?</span>;
<span class="kw">let </span><span class="kw-2">mut </span>reader = ArrowReaderBuilder::try_new(file)<span class="question-mark">?</span>.build()<span class="question-mark">?</span>;

<span class="comment">// You can check if a column contains a Variant using
// the VariantType extension type
</span><span class="kw">let </span>schema = reader.schema();
<span class="kw">let </span>field = schema.field_with_name(<span class="string">"var"</span>)<span class="question-mark">?</span>;
<span class="macro">assert!</span>(field.try_extension_type::&lt;VariantType&gt;().is_ok());

<span class="comment">// The reader will yield RecordBatches with a StructArray
// to convert them to VariantArray, use VariantArray::try_new
</span><span class="kw">let </span>batch = reader.next().unwrap().unwrap();

<span class="kw">let </span>col = batch.column_by_name(<span class="string">"var"</span>).unwrap();
<span class="kw">let </span>var_array = VariantArray::try_new(col)<span class="question-mark">?</span>;
<span class="macro">assert_eq!</span>(var_array.len(), <span class="number">1</span>);
<span class="kw">let </span>var_value: Variant = var_array.value(<span class="number">0</span>);
<span class="macro">assert_eq!</span>(var_value, Variant::from(<span class="string">"iceberg"</span>)); <span class="comment">// the value in case-075.parquet</span></code></pre></div></div></details><h2 id="structs" class="section-header">Structs<a href="#structs" class="anchor">¬ß</a></h2><dl class="item-table"><dt><a class="struct" href="struct.BorrowedShreddingState.html" title="struct parquet::variant::BorrowedShreddingState">Borrowed<wbr>Shredding<wbr>State</a></dt><dd>Similar to <a href="struct.ShreddingState.html" title="struct parquet::variant::ShreddingState"><code>ShreddingState</code></a> except it holds borrowed references of the target arrays. Useful
for avoiding clone operations when the caller does not need a self-standing shredding state.</dd><dt><a class="struct" href="struct.CastOptions.html" title="struct parquet::variant::CastOptions">Cast<wbr>Options</a></dt><dd>Options for controlling the behavior of <code>cast_to_variant_with_options</code>.</dd><dt><a class="struct" href="struct.GetOptions.html" title="struct parquet::variant::GetOptions">GetOptions</a></dt><dd>Controls the action of the variant_get kernel.</dd><dt><a class="struct" href="struct.ListBuilder.html" title="struct parquet::variant::ListBuilder">List<wbr>Builder</a></dt><dd>A builder for creating <a href="enum.Variant.html#variant.List" title="variant parquet::variant::Variant::List"><code>Variant::List</code></a> values.</dd><dt><a class="struct" href="struct.ListState.html" title="struct parquet::variant::ListState">List<wbr>State</a></dt><dd>Internal state for list building</dd><dt><a class="struct" href="struct.ObjectBuilder.html" title="struct parquet::variant::ObjectBuilder">Object<wbr>Builder</a></dt><dd>A builder for creating <a href="enum.Variant.html#variant.Object" title="variant parquet::variant::Variant::Object"><code>Variant::Object</code></a> values.</dd><dt><a class="struct" href="struct.ObjectFieldBuilder.html" title="struct parquet::variant::ObjectFieldBuilder">Object<wbr>Field<wbr>Builder</a></dt><dd>A <a href="trait.VariantBuilderExt.html" title="trait parquet::variant::VariantBuilderExt"><code>VariantBuilderExt</code></a> that inserts a new field into a variant object.</dd><dt><a class="struct" href="struct.ObjectState.html" title="struct parquet::variant::ObjectState">Object<wbr>State</a></dt><dd>Internal state for object building</dd><dt><a class="struct" href="struct.ParentState.html" title="struct parquet::variant::ParentState">Parent<wbr>State</a></dt><dd>Tracks information needed to correctly finalize a nested builder.</dd><dt><a class="struct" href="struct.ReadOnlyMetadataBuilder.html" title="struct parquet::variant::ReadOnlyMetadataBuilder">Read<wbr>Only<wbr>Metadata<wbr>Builder</a></dt><dd>A metadata builder that cannot register new field names, and merely returns the field id
associated with a known field name. This is useful for variant unshredding operations, where the
metadata column is fixed and ‚Äì per variant shredding spec ‚Äì already contains all field names
from the typed_value column. It is also useful when projecting a subset of fields from a variant
object value, since the bytes can be copied across directly without re-encoding their field ids.</dd><dt><a class="struct" href="struct.ShortString.html" title="struct parquet::variant::ShortString">Short<wbr>String</a></dt><dd>A Variant <a href="struct.ShortString.html" title="struct parquet::variant::ShortString"><code>ShortString</code></a></dd><dt><a class="struct" href="struct.ShreddingState.html" title="struct parquet::variant::ShreddingState">Shredding<wbr>State</a></dt><dd>Represents the shredding state of a <a href="struct.VariantArray.html" title="struct parquet::variant::VariantArray"><code>VariantArray</code></a></dd><dt><a class="struct" href="struct.Uuid.html" title="struct parquet::variant::Uuid">Uuid</a></dt><dd>A Universally Unique Identifier (UUID).</dd><dt><a class="struct" href="struct.ValueBuilder.html" title="struct parquet::variant::ValueBuilder">Value<wbr>Builder</a></dt><dd>Wrapper around a <code>Vec&lt;u8&gt;</code> that provides methods for appending
primitive values, variant types, and metadata.</dd><dt><a class="struct" href="struct.VariantArray.html" title="struct parquet::variant::VariantArray">Variant<wbr>Array</a></dt><dd>An array of Parquet <a href="enum.Variant.html" title="enum parquet::variant::Variant"><code>Variant</code></a> values</dd><dt><a class="struct" href="struct.VariantArrayBuilder.html" title="struct parquet::variant::VariantArrayBuilder">Variant<wbr>Array<wbr>Builder</a></dt><dd>A builder for <a href="struct.VariantArray.html" title="struct parquet::variant::VariantArray"><code>VariantArray</code></a></dd><dt><a class="struct" href="struct.VariantBuilder.html" title="struct parquet::variant::VariantBuilder">Variant<wbr>Builder</a></dt><dd>Top level builder for <a href="enum.Variant.html" title="enum parquet::variant::Variant"><code>Variant</code></a> values</dd><dt><a class="struct" href="struct.VariantDecimal4.html" title="struct parquet::variant::VariantDecimal4">Variant<wbr>Decimal4</a></dt><dd>Represents a 4-byte decimal value in the Variant format.</dd><dt><a class="struct" href="struct.VariantDecimal8.html" title="struct parquet::variant::VariantDecimal8">Variant<wbr>Decimal8</a></dt><dd>Represents an 8-byte decimal value in the Variant format.</dd><dt><a class="struct" href="struct.VariantDecimal16.html" title="struct parquet::variant::VariantDecimal16">Variant<wbr>Decimal16</a></dt><dd>Represents an 16-byte decimal value in the Variant format.</dd><dt><a class="struct" href="struct.VariantList.html" title="struct parquet::variant::VariantList">Variant<wbr>List</a></dt><dd><a href="enum.Variant.html" title="enum parquet::variant::Variant"><code>Variant</code></a> Array.</dd><dt><a class="struct" href="struct.VariantMetadata.html" title="struct parquet::variant::VariantMetadata">Variant<wbr>Metadata</a></dt><dd><a href="enum.Variant.html" title="enum parquet::variant::Variant"><code>Variant</code></a> Metadata</dd><dt><a class="struct" href="struct.VariantObject.html" title="struct parquet::variant::VariantObject">Variant<wbr>Object</a></dt><dd>A <a href="enum.Variant.html" title="enum parquet::variant::Variant"><code>Variant</code></a> Object (struct with named fields).</dd><dt><a class="struct" href="struct.VariantPath.html" title="struct parquet::variant::VariantPath">Variant<wbr>Path</a></dt><dd>Represents a qualified path to a potential subfield or index of a variant
value.</dd><dt><a class="struct" href="struct.VariantType.html" title="struct parquet::variant::VariantType">Variant<wbr>Type</a></dt><dd>Arrow Variant [<code>ExtensionType</code>].</dd><dt><a class="struct" href="struct.VariantValueArrayBuilder.html" title="struct parquet::variant::VariantValueArrayBuilder">Variant<wbr>Value<wbr>Array<wbr>Builder</a></dt><dd>A builder for creating only the value column of a <a href="struct.VariantArray.html" title="struct parquet::variant::VariantArray"><code>VariantArray</code></a></dd><dt><a class="struct" href="struct.WritableMetadataBuilder.html" title="struct parquet::variant::WritableMetadataBuilder">Writable<wbr>Metadata<wbr>Builder</a></dt><dd>Builder for constructing metadata for <a href="enum.Variant.html" title="enum parquet::variant::Variant"><code>Variant</code></a> values.</dd><dt><a class="struct" href="struct.f16.html" title="struct parquet::variant::f16">f16</a></dt><dd>A 16-bit floating point type implementing the IEEE 754-2008 standard <a href="https://en.wikipedia.org/wiki/Half-precision_floating-point_format"><code>binary16</code></a> a.k.a ‚Äúhalf‚Äù
format.</dd></dl><h2 id="enums" class="section-header">Enums<a href="#enums" class="anchor">¬ß</a></h2><dl class="item-table"><dt><a class="enum" href="enum.Variant.html" title="enum parquet::variant::Variant">Variant</a></dt><dd>Represents a <a href="https://github.com/apache/parquet-format/blob/master/VariantEncoding.md">Parquet Variant</a></dd><dt><a class="enum" href="enum.VariantPathElement.html" title="enum parquet::variant::VariantPathElement">Variant<wbr>Path<wbr>Element</a></dt><dd>Element of a <a href="struct.VariantPath.html" title="struct parquet::variant::VariantPath"><code>VariantPath</code></a> that can be a field name or an index.</dd></dl><h2 id="constants" class="section-header">Constants<a href="#constants" class="anchor">¬ß</a></h2><dl class="item-table"><dt><a class="constant" href="constant.EMPTY_VARIANT_METADATA.html" title="constant parquet::variant::EMPTY_VARIANT_METADATA">EMPTY_<wbr>VARIANT_<wbr>METADATA</a></dt><dd>The empty metadata dictionary.</dd><dt><a class="constant" href="constant.EMPTY_VARIANT_METADATA_BYTES.html" title="constant parquet::variant::EMPTY_VARIANT_METADATA_BYTES">EMPTY_<wbr>VARIANT_<wbr>METADATA_<wbr>BYTES</a></dt><dd>The canonical byte slice corresponding to an empty metadata dictionary.</dd></dl><h2 id="traits" class="section-header">Traits<a href="#traits" class="anchor">¬ß</a></h2><dl class="item-table"><dt><a class="trait" href="trait.BuilderSpecificState.html" title="trait parquet::variant::BuilderSpecificState">Builder<wbr>Specific<wbr>State</a></dt><dd>A trait for managing state specific to different builder types.</dd><dt><a class="trait" href="trait.MetadataBuilder.html" title="trait parquet::variant::MetadataBuilder">Metadata<wbr>Builder</a></dt><dd>A trait for building variant metadata dictionaries, to be used in conjunction with a
<a href="struct.ValueBuilder.html" title="struct parquet::variant::ValueBuilder"><code>ValueBuilder</code></a>. The trait provides methods for managing field names and their IDs, as well as
rolling back a failed builder operation that might have created new field ids.</dd><dt><a class="trait" href="trait.VariantBuilderExt.html" title="trait parquet::variant::VariantBuilderExt">Variant<wbr>Builder<wbr>Ext</a></dt><dd>Extends <a href="struct.VariantBuilder.html" title="struct parquet::variant::VariantBuilder"><code>VariantBuilder</code></a> to help building nested <a href="enum.Variant.html" title="enum parquet::variant::Variant"><code>Variant</code></a>s</dd><dt><a class="trait" href="trait.VariantDecimalType.html" title="trait parquet::variant::VariantDecimalType">Variant<wbr>Decimal<wbr>Type</a></dt><dd>Trait for variant decimal types, enabling generic code across Decimal4/8/16</dd></dl><h2 id="functions" class="section-header">Functions<a href="#functions" class="anchor">¬ß</a></h2><dl class="item-table"><dt><a class="fn" href="fn.cast_to_variant.html" title="fn parquet::variant::cast_to_variant">cast_<wbr>to_<wbr>variant</a></dt><dd>Convert an array to a <a href="struct.VariantArray.html" title="struct parquet::variant::VariantArray"><code>VariantArray</code></a> with strict mode enabled (returns errors on conversion
failures).</dd><dt><a class="fn" href="fn.cast_to_variant_with_options.html" title="fn parquet::variant::cast_to_variant_with_options">cast_<wbr>to_<wbr>variant_<wbr>with_<wbr>options</a></dt><dd>Casts a typed arrow [<code>Array</code>] to a <a href="struct.VariantArray.html" title="struct parquet::variant::VariantArray"><code>VariantArray</code></a>. This is useful when you
need to convert a specific data type</dd><dt><a class="fn" href="fn.json_to_variant.html" title="fn parquet::variant::json_to_variant">json_<wbr>to_<wbr>variant</a></dt><dd>Parse a batch of JSON strings into a batch of Variants represented as
STRUCT&lt;metadata: BINARY, value: BINARY&gt; where nulls are preserved. The JSON strings in the input
must be valid.</dd><dt><a class="fn" href="fn.shred_variant.html" title="fn parquet::variant::shred_variant">shred_<wbr>variant</a></dt><dd>Shreds the input binary variant using a target shredding schema derived from the requested data type.</dd><dt><a class="fn" href="fn.unshred_variant.html" title="fn parquet::variant::unshred_variant">unshred_<wbr>variant</a></dt><dd>Removes all (nested) typed_value columns from a VariantArray by converting them back to binary
variant and merging the resulting values back into the value column.</dd><dt><a class="fn" href="fn.variant_get.html" title="fn parquet::variant::variant_get">variant_<wbr>get</a></dt><dd>Returns an array with the specified path extracted from the variant values.</dd><dt><a class="fn" href="fn.variant_to_json.html" title="fn parquet::variant::variant_to_json">variant_<wbr>to_<wbr>json</a></dt><dd>Transform a batch of Variant represented as STRUCT&lt;metadata: BINARY, value: BINARY&gt; to a batch
of JSON strings where nulls are preserved. The JSON strings in the input must be valid.</dd></dl></section></div></main></body></html>